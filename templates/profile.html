{% extends "base.html" %}

{% block title %}User Profile - Miss Pauling{% endblock %}

{% block content %}
<div class="mx-auto max-w-md p-4">
    <h1 class="mb-8 text-center text-3xl font-bold">User Profile</h1>

    <div class="mb-6 rounded-lg border border-green-200 bg-green-50 p-4">
        <div class="mb-4 flex items-center justify-center">
            <div class="text-center">
                {% if user.avatar %}
                    <img src="{{ user.avatar }}" alt="User Avatar" class="mx-auto mb-2 h-20 w-20 rounded-full" />
                {% endif %}
                <span class="block text-xl font-semibold">{{ user.name or 'User' }}</span>
            </div>
        </div>

        <!-- Error/Success Messages -->
        <div id="message-container">
            {% if error %}
                <div class="mb-3 rounded border border-red-400 bg-red-100 px-3 py-2 text-sm text-red-700">
                    {{ error }}
                </div>
            {% endif %}
            {% if success %}
                <div class="mb-3 rounded border border-green-400 bg-green-100 px-3 py-2 text-sm text-green-700">
                    {{ success }}
                </div>
            {% endif %}
        </div>

        <div class="space-y-4">
            <h3 class="font-semibold">Linked Accounts:</h3>

            <!-- Discord Account -->
            <div class="flex items-center justify-between">
                <span>
                    <span class="font-medium">Discord:</span>
                    {% if user.discord_id %}
                        <span class="text-green-600">✓ Linked</span>
                        <span class="block text-xs text-gray-600">ID: {{ user.discord_id }}</span>
                    {% else %}
                        <span class="text-red-600">✗ Not Linked</span>
                    {% endif %}
                </span>
                {% if not user.discord_id %}
                    <form action="/auth/discord/link" method="post" style="display: inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="rounded bg-indigo-500 px-3 py-1 text-sm text-white hover:bg-indigo-600">
                            Link Discord Account
                        </button>
                    </form>
                {% else %}
                    <div class="text-xs text-gray-600">
                        <span class="font-medium text-indigo-600">Primary Account</span>
                        <span class="block italic">(Cannot be unlinked)</span>
                    </div>
                {% endif %}
            </div>

            <!-- Steam Account -->
            <div class="flex items-center justify-between">
                <span>
                    <span class="font-medium">Steam:</span>
                    {% if user.steam_id64 %}
                        <span class="text-green-600">✓ Linked</span>
                        <span class="block text-xs text-gray-600">ID: {{ user.steam_id64 }}</span>
                        <button onclick="toggleSteamDetails()" class="mt-1 text-xs text-blue-600 hover:underline">
                            <span id="steam-details-toggle">Show details</span>
                        </button>

                        <div id="steam-details" class="mt-2 rounded border border-gray-200 bg-gray-50 p-2 text-xs" style="display: none;">
                            {% if user.steam_profile_url %}
                                <div class="mb-1 flex items-center justify-between">
                                    <div>
                                        <strong>Steam Profile:</strong>
                                        <a href="{{ user.steam_profile_url }}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                                            View Profile
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                            
                            <div class="mb-1 flex items-center justify-between">
                                <div><strong>Steam ID64:</strong> {{ user.steam_id64 }}</div>
                                <button onclick="copyToClipboard('{{ user.steam_id64 }}', 'steam_id64')" 
                                        class="ml-2 rounded bg-gray-200 px-1.5 py-0.5 text-xs hover:bg-gray-300"
                                        id="copy-steam_id64">
                                    Copy
                                </button>
                            </div>

                            {% if user.steam_id %}
                                <div class="mb-1 flex items-center justify-between">
                                    <div><strong>Steam ID:</strong> {{ user.steam_id }}</div>
                                    <button onclick="copyToClipboard('{{ user.steam_id }}', 'steam_id')" 
                                            class="ml-2 rounded bg-gray-200 px-1.5 py-0.5 text-xs hover:bg-gray-300"
                                            id="copy-steam_id">
                                        Copy
                                    </button>
                                </div>
                            {% endif %}

                            {% if user.steam_id3 %}
                                <div class="mb-1 flex items-center justify-between">
                                    <div><strong>Steam ID3:</strong> {{ user.steam_id3 }}</div>
                                    <button onclick="copyToClipboard('{{ user.steam_id3 }}', 'steam_id3')" 
                                            class="ml-2 rounded bg-gray-200 px-1.5 py-0.5 text-xs hover:bg-gray-300"
                                            id="copy-steam_id3">
                                        Copy
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <span class="text-red-600">✗ Not Linked</span>
                    {% endif %}
                </span>
                
                <div class="flex space-x-2">
                    {% if not user.steam_id64 %}
                        <form action="/auth/steam/link" method="post" style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" class="rounded bg-indigo-500 px-3 py-1 text-sm text-white hover:bg-indigo-600">
                                Link Steam Account
                            </button>
                        </form>
                    {% else %}
                        <form action="/auth/sync-steam" method="post" style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" 
                                    class="rounded bg-blue-400 px-2 py-1 text-sm text-white hover:bg-blue-500"
                                    id="sync-steam-btn">
                                Sync
                            </button>
                        </form>
                        <form action="/auth/unlink" method="post" style="display: inline;">
                            <input type="hidden" name="provider" value="steam">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" 
                                    class="rounded bg-red-400 px-2 py-1 text-sm text-white hover:bg-red-500"
                                    onclick="return confirmUnlink('steam')">
                                Unlink
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 text-center">
        <a href="/" class="text-blue-600 hover:underline">
            Back to Home
        </a>
    </div>
</div>
{% endblock %}